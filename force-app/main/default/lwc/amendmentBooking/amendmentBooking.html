<template>


    
        <template if:true={showOptions}>
            <lightning-card>
                <!-- Header Section -->
                <header class="slds-modal__header">
                    
                    <h2 class="slds-text-heading_medium">Amend Booking</h2>
                </header>
                <div class="slds-p-around_medium">
                    <div class="slds-modal__content slds-p-around_medium">
                        <lightning-radio-group
                            label="Select an option"
                            options={options}
                            value={selectedOption}
                            onchange={handleSelection}>
                        </lightning-radio-group>
                    </div>
                </div>
                <!-- Footer Section -->
                <footer class="slds-modal__footer">
                    <lightning-button variant="brand" label="Next" onclick={handleNext}></lightning-button>
                </footer>
            </lightning-card>
        </template>

        <!-- Render Add Passengers -->
        <template if:true={isAddPassengers}>
            <lightning-card title="Add Passengers">
                <div class="slds-card__body">
                    <lightning-layout multiple-rows="true">
                        <lightning-layout-item size="4" class="slds-p-around_small">
                            <div class="counter">
                                <span>Adult</span>
                                <button data-id="decrementAdult"   onclick={decrementAdult} class="btn minus">-</button>
                                <span class="count">{adultCount}</span>
                                <button data-id="incrementAdult" onclick={incrementAdult} class="btn plus">+</button>
                                <span class="age-range">12 years & above</span>
                            </div>
                        </lightning-layout-item>
                        <lightning-layout-item size="3" class="slds-p-around_small">
                            <div class="counter">
                                <span>Child</span>
                                <button onclick={decrementChild} class="btn minus">-</button>
                                <span class="count">{childCount}</span>
                                <button onclick={incrementChild} class="btn plus">+</button>
                                <span class="age-range">2-11 years</span>
                            </div>
                        </lightning-layout-item>
                        <lightning-layout-item size="4" class="slds-p-around_small">
                            <div class="counter">
                                <span>Infant</span>
                                <button onclick={decrementInfant} class="btn minus">-</button>
                                <span class="count">{infantCount}</span>
                                <button onclick={incrementInfant} class="btn plus">+</button>
                                <span class="age-range">Below 2 years</span>
                            </div>
                        </lightning-layout-item>
                    </lightning-layout>
                </div>
            </lightning-card>
            <!-- Button to send selected values to Apex -->
            <footer class="slds-modal__footer">
                <lightning-button variant="neutral" label="Previous" onclick={openFirstPage} style="margin-right: 10px;"></lightning-button>
                <lightning-button variant="brand" label="Next" onclick={openPassengersPage}></lightning-button>
            </footer>
        </template>
         <!-- Open Passenger Page -->
          
         
        <template if:true={passengerDetailPage}>
            <lightning-card title="Order Summary">
                <div class="slds-card__body">
                    <template if:true={orderSummary}>
                        <div class="param2-container">
                            <div class="param2-box">
                                <template for:each={orderSummary} for:item="value">
                                    <div key={value} style="font-family: Brandon !important;font-size: 16px;">
                                        <lightning-layout multiple-rows="true">
                                            <lightning-layout-item size="3" class="slds-p-around_small" style="text-align: left;">
                                                {value.name}
                                            </lightning-layout-item>
                                            <lightning-layout-item size="6" class="slds-p-around_small">
                                                <p>&#8377; {value.amount}</p> <!-- Show the param2 of the selected row -->
                                            </lightning-layout-item>
                                        </lightning-layout>  
                                    </div>
                                </template>
                                <template if:true={showGst}>
                                    <strong>Net Amount : &#8377; {totalNetAmount}</strong>
                                        <template if:true={showCgst}>
                                            <strong>CGST Amount (9%) : &#8377; {totalCgstAmount}</strong>
                                            <strong>SGST Amount (9%): &#8377; {totalSgstAmount}</strong>                                    
                                        </template>
                                        <template if:true={showIgst}>
                                            <strong>IGST Amount (18%): &#8377; {totalIgstAmount}</strong>                                    
                                        </template>
                                </template>
                                
                                <strong>Final Amount : &#8377; {totalAmount}</strong> <!-- Show the param2 of the selected row --> 
                            </div>
                        </div>
                    </template>
                </div>
            </lightning-card>
            <lightning-card title="Guest Details">
                <template for:each={guestRows} for:item="guest" for:index="index">
                    <div key={guest.id} class="guest-row">
                        <lightning-layout horizontal-align="start">
                            <lightning-layout-item padding="around-small" size="auto"  class="fixed-width">
                                <lightning-input class="input-field" label="Passenger" value={guest.pass} disabled></lightning-input>
                            </lightning-layout-item>
                            <!-- Title field (disabled for display purpose) -->
                            <lightning-layout-item padding="around-small" size="auto"  class="fixed-width">
                            <lightning-combobox class="input-field" 
                                label="Title" 
                                value={guest.title} 
                                options={titleOptions} 
                                onchange={handleChange}
                                data-index={index}
                                required>
                            </lightning-combobox>
                            </lightning-layout-item>
                            
                            <!-- First Name field -->
                            <lightning-layout-item padding="around-small" size="auto" class="fixed-width">
                            <lightning-input class="input-field" type="text" required data-index={index} label="First Name" pattern="[a-zA-Z\s]*" value={guest.firstname} onchange={handleChange}></lightning-input>
                            </lightning-layout-item>
                            <!-- Last Name field -->
                            <lightning-layout-item padding="around-small" size="auto" class="fixed-width">
                            <lightning-input class="input-field" type="text" required data-index={index} label="Last Name" pattern="[a-zA-Z\s]*" value={guest.lastname} onchange={handleChange}></lightning-input>
                            </lightning-layout-item>
                            <!-- Gender field (Picklist) -->
                            <lightning-layout-item padding="around-small" size="auto" class="fixed-width">
                            <lightning-combobox class="input-field" required data-index={index} label="Gender" value={guest.gender} options={genderOptions} onchange={handleChange}></lightning-combobox>
                            </lightning-layout-item>
                            <!-- Age field -->
                            <lightning-layout-item padding="around-small" size="auto" class="fixed-width">
                            <lightning-input class="input-field" type="number" data-index={index} label="Age" pattern="^\d{1,3}$" value={guest.age} onchange={handleChange}></lightning-input>
                            </lightning-layout-item>
                            <!-- Designation field -->
                            <lightning-layout-item padding="around-small" size="auto"  class="fixed-width">
                            <lightning-input class="input-field" data-index={index} label="Designation" value={guest.designation} onchange={handleChange}></lightning-input>
                            </lightning-layout-item>
                            <!-- Travel Class field (Picklist) -->
                            <lightning-layout-item padding="around-small" size="auto"  class="fixed-width">
                            <lightning-combobox class="input-field" data-index={index} label="Travel Class" value={guest.travelclass} options={travelClassOptions} onchange={handleChange}></lightning-combobox>
                            </lightning-layout-item>
                            <!-- Travel PNR No field -->
                            <lightning-layout-item padding="around-small" size="auto"  class="fixed-width">
                            <lightning-input class="input-field" data-index={index} label="Travel PNR No" value={guest.travelpnrno} onchange={handleChange}></lightning-input>
                            </lightning-layout-item>
                            <!-- Travel Nationality field -->
                            <lightning-layout-item padding="around-small" size="auto"  class="fixed-width">
                                <label class="slds-form-element__label slds-no-flex">
                                    <template if:true={isNationalityRequired}>
                                        <span class="slds-required" style="color: #BA0517;">*</span>
                                    </template>
                                    Nationality
                                </label>
                                <lightning-input 
                                    onblur={handleDropDownClose}
                                    variant="label-hidden"
                                    value={guest.nationality} 
                                    onchange={handleNationalityChange} 
                                    onfocus={handleNationalityDropdownOpen} 
                                    label="Nationality"
                                    data-index={index}
                                    required={isNationalityRequired}>
                                </lightning-input>
                                <!-- Display filtered options in a dropdown-style list -->
                                <template if:true={guest.showDropdown}>
                                    <div class="dropdown">
                                        <template for:each={filteredNationalityOptions} for:item="option">
                                            <div key={option.value} class="dropdown-item" data-index={index} data-value={option.value} data-label={option.label} onmousedown={handleNationalityOptionSelect}>
                                                {option.label}
                                            </div>
                                        </template>
                                    </div>
                                </template>
                            </lightning-layout-item>
                            <!-- Travel Passport Number field -->
                            <lightning-layout-item padding="around-small" size="auto"  class="fixed-width">
                                <lightning-input class="input-field" data-index={index} label="Passport Number" value={guest.passportnumber} onchange={handleChange}></lightning-input>
                            </lightning-layout-item>
                            <!-- Travel Mobile field -->
                            <lightning-layout-item padding="around-small" size="auto"  class="fixed-width">
                                <lightning-input class="input-field" data-index={index} type ="text" pattern="^[\+\-]?[0-9]+$" label="Phone" value={guest.phone} onchange={handleChange}></lightning-input>
                            </lightning-layout-item>
                    </lightning-layout>
                    </div>
                </template>
            </lightning-card>
            <footer class="slds-modal__footer">
                <lightning-button label="Previous" class="encalmbg" variant="brand" onclick={openPassengerAddPage} style="margin-right: 10px;"></lightning-button>
                <lightning-button label="Submit" class="encalmbg" variant="brand" onclick={confirmPassengerSave} style="margin-right: 10px;"></lightning-button>
            </footer>
            
        </template>

        <!-- Render Upgrade Package -->
        <template if:true={isUpgradePackage}>   
                <template lwc:if={filteredPackages}>
                    <div class="slds-modal__content slds-p-around_medium slds-grid slds-nowrap slds-gutters">
                    <div class="slds-col slds-size_12-of-12">
                    <lightning-card title="Select Package to Upgrade">
                        <label class="slds-form-element__label slds-no-flex">
                            <span style="font-size: x-large;">Existing Package - {currentPackage}</span></label>
                        <div class="slds-card__body">
                            <div class="slds-grid slds-wrap"  style="margin-left: 15px;" slot="actions">
                                <template for:each={filteredPackages} for:item="pack" for:index="index">
                                    <div key={pack.packageName} if:true={pack.showPackage} class="slds-col slds-size_3-of-3 column">
                                        <div class="package">
                                            <!-- Apply the class to package name -->
                                            <div class="slds-text-heading_medium package-name row" style="padding-left: 10px;">
                                                <span class="left-value" style="font-size: x-large;">{pack.packageName}</span>
                                                <span class="right-value" style="text-align: right;">{currency} {pack.priceTag}</span>
                                            </div>                            
                                            <div class="slds-m-top_medium">
                        
                                                <!-- Iterate through services and display each row -->
                                                <ul class="slds-list_dotted">
                                                    <template for:each={pack.services} for:item="row">
                                                        <li key={row} class="slds-item">{row}</li>
                                                    </template>
                                                </ul>
                        
                                                <!-- Select Button -->
                                                <lightning-button 
                                                    label={pack.buttonLabel} 
                                                    data-index={index} 
                                                    onclick={handleSelect}>
                                                </lightning-button>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </lightning-card>
                    </div>
                    <div class="slds-col slds-size_9-of-12">
                    <lightning-card title="Order Summary">
                        <div class="slds-card__body">
                            <template if:true={orderSummaryPackageUpgrade}>
                                <div class="param2-container">
                                    <div class="param2-box">
                                        
                                        
                                        <lightning-layout multiple-rows="true">
                                            <lightning-layout-item size="6" class="slds-p-around_small" style="font-family: Brandon !important;font-size: 16px;text-align: left;">
                                                Existing Package Paid Amount
                                            </lightning-layout-item>
                                            <lightning-layout-item size="3" class="slds-p-around_small">
                                                <p>&#8377; {currentTotalPackageAmount}</p> <!-- Show the param2 of the selected row -->
                                            </lightning-layout-item>
                                        </lightning-layout> 
                                        <template for:each={orderSummaryPackageUpgrade} for:item="value">
                                            <div key={value} style="font-family: Brandon !important;font-size: 16px;">
                                                <lightning-layout multiple-rows="true">
                                                    <lightning-layout-item size="6" class="slds-p-around_small" style="text-align: left;">
                                                        {value.name}
                                                    </lightning-layout-item>
                                                    <lightning-layout-item size="3" class="slds-p-around_small">
                                                        <p>&#8377; {value.amount}</p> <!-- Show the param2 of the selected row -->
                                                    </lightning-layout-item>
                                                </lightning-layout>  
                                            </div>
                                        </template>
                                        <lightning-layout multiple-rows="true">
                                            <lightning-layout-item size="6" class="slds-p-around_small" style="font-family: Brandon !important;font-size: 16px;text-align: left;">
                                                Total Amount for selected package
                                            </lightning-layout-item>
                                            <lightning-layout-item size="3" class="slds-p-around_small">
                                                <p>&#8377; {totalAmount}</p> <!-- Show the param2 of the selected row -->
                                            </lightning-layout-item>
                                        </lightning-layout> 
                                        <br><br>
                                        <strong>Final Amount to be paid: &#8377; {totalAmount} - {currentTotalPackageAmount} = {totalPackageUpgradeAmount}</strong> <!-- Show the param2 of the selected row --> 
                                    </div>
                                </div>
                            </template>
                        </div>
                    </lightning-card>
                    </div>
                    </div>
                    <footer class="slds-modal__footer">
                        <lightning-button label="Previous" class="encalmbg" variant="brand" onclick={openFirstPage} style="margin-right: 10px;"></lightning-button>
                        <lightning-button label="Submit" class="encalmbg" variant="brand" onclick={confirmPackageUpgrade} style="margin-right: 10px;"></lightning-button>
                    </footer>
                </template>
                <template lwc:else>
                    <label class="slds-form-element__label slds-no-flex">
                        <span style="font-size: x-large;">{upgradeMessage}</span></label>
                        
                    <footer class="slds-modal__footer">
                        <lightning-button label="Previous" class="encalmbg" variant="brand" onclick={openFirstPage} style="margin-right: 10px;"></lightning-button>
                    </footer>
                </template>
        </template>

        <!-- Render Add Add-Ons -->
        <template if:true={isAddAddOns}>
            <lightning-card>
                <div class="slds-card__body">
                <template if:true={getAddonDetail}>
                    <div style="font-weight: bold;font-size: 16px;margin-left: 16px;">Select Add Ons</div>
                    <div class="slds-card__body">
                        <div class="slds-grid slds-wrap"  style="margin-left: 15px;" slot="actions">
                            <template for:each={getAddonDetail} for:item="pack"  for:index="index">
                                <div key={pack.packageName} class="slds-col slds-size_1-of-3 column">
                                    <div class="package">
                                         
                                        <div class="slds-text-heading_small package-name row" style="padding-left: 10px;">
                                        <!-- Apply the class to package name
                                        <div class="slds-text-heading_small package-name row" style="padding-left: 10px;">{currency} {pack.addOnTag}</div>-->
                                        <span class="left-value-addon">{pack.addOnName}</span>
                                        <span class="right-value-addon">{currency} {pack.addOnTag}</span>
                                        </div>
                                        <div class="slds-m-top_medium">
                                    </br>
                                    <div>
                                        <!-- Pickup Terminals -->
                                    <template for:each={pack.pickupTerminals} for:item="terminal" for:index="index">
                                        <lightning-combobox
                                            key={terminal.id}
                                            name="pickup"
                                            label={terminal.id}
                                            options={pickupTerminalOptions}
                                            value={terminal.value}
                                            data-index={index}
                                            data-id={pack.addOnName}
                                            onchange={handleTerminalChange}
                                            required
                                            message-when-value-missing="Please select a Pickup Terminal"
                                            class={pack.pickupErrorClass} 
                                            disabled={pack.disablePickup}>
                                        </lightning-combobox>
                                    </template>
            
                                        <!-- Drop Terminals -->
                                    <template if:false={pack.hideDropTerminal}>
                                        <template for:each={pack.dropTerminals} for:item="terminal" for:index="index">                                        
                                            <lightning-combobox
                                                key={terminal.id}
                                                name="drop"
                                                label={terminal.id}
                                                options={dropTerminalOptions}
                                                value={terminal.value}
                                                data-index={index}
                                                data-id={pack.addOnName}
                                                onchange={handleTerminalChange}
                                                required
                                                message-when-value-missing="Please select a Drop Terminal"
                                                class={pack.dropErrorClass} 
                                                disabled={pack.disableDrop}>
                                            </lightning-combobox>
                                        </template>
                                    </template>
                                    </div>
                                        <div class="counter">
                                            <span>Qty</span>
                                            <button data-id="decrementAddOn" data-index={index}  onclick={decrementAddOn} class="btn minus">-</button>
                                            <span class="count">{pack.adddOnCount}</span>
                                            <button data-id="incrementAddOn" data-index={index} onclick={incrementAddOn} class="btn plus">+</button>
                                        </div>
                                    </br>
                                    <button onclick={handleAddOnSelect} data-index={index} class={pack.class}>{pack.buttonLabel}</button> 
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
                </div>
            </lightning-card>
            <lightning-card title="Order Summary">
                <div class="slds-card__body">
                    <template if:true={orderSummaryAddon}>
                        <div class="param2-container">
                            <div class="param2-box">
                                <template for:each={orderSummaryAddon} for:item="value">
                                    <div key={value} style="font-family: Brandon !important;font-size: 16px;">
                                        <lightning-layout multiple-rows="true">
                                            <lightning-layout-item size="3" class="slds-p-around_small" style="text-align: left;">
                                                {value.name}
                                            </lightning-layout-item>
                                            <lightning-layout-item size="6" class="slds-p-around_small">
                                                <p>&#8377; {value.amount}</p> <!-- Show the param2 of the selected row -->
                                            </lightning-layout-item>
                                        </lightning-layout>  
                                    </div>
                                </template>
                                <template if:true={showGst}>
                                    <strong>Net Amount : &#8377; {totalNetAmount}</strong>
                                        <template if:true={showCgst}>
                                            <strong>CGST Amount (9%) : &#8377; {totalCgstAmount}</strong>
                                            <strong>SGST Amount (9%): &#8377; {totalSgstAmount}</strong>                                    
                                        </template>
                                        <template if:true={showIgst}>
                                            <strong>IGST Amount (18%): &#8377; {totalIgstAmount}</strong>                                    
                                        </template>
                                </template>
                                <strong>Final Amount : &#8377; {totalAddonAmount}</strong> <!-- Show the param2 of the selected row --> 
                            </div>
                        </div>
                    </template>
                </div>
            </lightning-card>
            
            <footer class="slds-modal__footer">
                <lightning-button label="Previous" class="encalmbg" variant="brand" onclick={openFirstPage} style="margin-right: 10px;"></lightning-button>
                <lightning-button label="Submit" class="encalmbg" variant="brand" onclick={confirmAddOnSave} style="margin-right: 10px;"></lightning-button>
            </footer>
        </template>

        <!-- Render All -->
        <template if:true={isAll}>
                <template if:false={isPaxAll}>
                    <lightning-card title="Order Summary">
                        <div class="slds-card__body">
                            <template if:true={orderSummaryPackageUpgradeAll}>
                                <div class="param2-container">
                                    <div class="param2-box">
                                        <template if:true={showPaidAmount}>
                                            <lightning-layout multiple-rows="true">
                                                <lightning-layout-item size="6" class="slds-p-around_small" style="font-family: Brandon !important;font-size: 16px;text-align: left;">
                                                    Existing Package Paid Amount
                                                </lightning-layout-item>
                                                <lightning-layout-item size="3" class="slds-p-around_small">
                                                    <p>&#8377; {currentTotalPackageAmount}</p> <!-- Show the param2 of the selected row -->
                                                </lightning-layout-item>
                                            </lightning-layout> 
                                        </template>
                                        <template for:each={orderSummaryPackageUpgradeAll} for:item="value">
                                            <div key={value} style="font-family: Brandon !important;font-size: 16px;">
                                                <lightning-layout multiple-rows="true">
                                                    <lightning-layout-item size="6" class="slds-p-around_small" style="text-align: left;">
                                                        {value.name}
                                                    </lightning-layout-item>
                                                    <lightning-layout-item size="3" class="slds-p-around_small">
                                                        <p>&#8377; {value.amount}</p> <!-- Show the param2 of the selected row -->
                                                    </lightning-layout-item>
                                                </lightning-layout> 
                                            </div>
                                        </template>
                                        <template if:true={showGst}>
                                            <strong>Net Amount : &#8377; {totalNetAmount}</strong>
                                                <template if:true={showCgst}>
                                                    <strong>CGST Amount (9%) : &#8377; {totalCgstAmount}</strong>
                                                    <strong>SGST Amount (9%): &#8377; {totalSgstAmount}</strong>                                    
                                                </template>
                                                <template if:true={showIgst}>
                                                    <strong>IGST Amount (18%): &#8377; {totalIgstAmount}</strong>                                    
                                                </template>
                                        </template>
                                        <template if:true={showPaidAmount}>
                                            <strong>Total Amount: &#8377; {totalAmountAll}</strong> <!-- Amount with upgrade --> 
                                            <strong>Final Amount to be paid: &#8377; {totalAmountAll} - {currentTotalPackageAmount} = {totalExtraAmountAll}</strong> <!-- Amount with upgrade --> 
                                        </template>
                                        <template if:false={showPaidAmount}>
                                            <strong>Total Amount: &#8377; {totalAmountAll}</strong> <!-- Amount when no upgrade --> 
                                        </template>
                                        
                                    </div>
                                </div>
                            </template>
                        </div>
                    </lightning-card>
                </template>
                <template lwc:if={isPaxAll}>
                    <lightning-card title="Add Passengers">
                        <div class="slds-card__body">
                            <lightning-layout multiple-rows="true">
                                <lightning-layout-item size="4" class="slds-p-around_small">
                                    <div class="counter">
                                        <span>Adult</span>
                                        <button data-id="decrementAdult"   onclick={decrementAdult} class="btn minus">-</button>
                                        <span class="count">{numberOfAdultsAll}</span>
                                        <button data-id="incrementAdult" onclick={incrementAdult} class="btn plus">+</button>
                                        <span class="age-range">12 years & above</span>
                                    </div>
                                </lightning-layout-item>
                                <lightning-layout-item size="3" class="slds-p-around_small">
                                    <div class="counter">
                                        <span>Child</span>
                                        <button onclick={decrementChild} class="btn minus">-</button>
                                        <span class="count">{numberOfChildrenAll}</span>
                                        <button onclick={incrementChild} class="btn plus">+</button>
                                        <span class="age-range">2-11 years</span>
                                    </div>
                                </lightning-layout-item>
                                <lightning-layout-item size="4" class="slds-p-around_small">
                                    <div class="counter">
                                        <span>Infant</span>
                                        <button onclick={decrementInfant} class="btn minus">-</button>
                                        <span class="count">{numberOfInfantsAll}</span>
                                        <button onclick={incrementInfant} class="btn plus">+</button>
                                        <span class="age-range">Below 2 years</span>
                                    </div>
                                </lightning-layout-item>
                            </lightning-layout>
                        </div>
                    </lightning-card>
                    <footer class="slds-modal__footer">
                        <lightning-button label="Previous" class="encalmbg" variant="brand" onclick={openFirstPage} style="margin-right: 10px;"></lightning-button>
                        <lightning-button label="Next" class="encalmbg" variant="brand" onclick={OpenPassengerInfo} style="margin-right: 10px;"></lightning-button>
                    </footer>
                </template>
                <template if:true={openPassengerPage}>
                    <lightning-card title="Guest Details" class="slds-size_3-of-4">
                        <template for:each={guestRowsAll} for:item="guest" for:index="index">
                            <div key={guest.id} class="guest-row">
                                <lightning-layout horizontal-align="start">
                                    <lightning-layout-item padding="around-small" size="auto"  class="fixed-width">
                                        <lightning-input class="input-field" label="Passenger" value={guest.pass} disabled></lightning-input>
                                    </lightning-layout-item>
                                    <!-- Title field (disabled for display purpose) -->
                                    <lightning-layout-item padding="around-small" size="auto"  class="fixed-width">
                                    <lightning-combobox class="input-field" 
                                        label="Title" 
                                        value={guest.title} 
                                        options={titleOptions} 
                                        onchange={handleChange}
                                        data-index={index}
                                        required>
                                    </lightning-combobox>
                                    </lightning-layout-item>
                                    
                                    <!-- First Name field -->
                                    <lightning-layout-item padding="around-small" size="auto" class="fixed-width">
                                    <lightning-input class="input-field" type="text" required data-index={index} label="First Name" pattern="[a-zA-Z\s]*" value={guest.firstname} onchange={handleChange}></lightning-input>
                                    </lightning-layout-item>
                                    <!-- Last Name field -->
                                    <lightning-layout-item padding="around-small" size="auto" class="fixed-width">
                                    <lightning-input class="input-field" type="text" required data-index={index} label="Last Name" pattern="[a-zA-Z\s]*" value={guest.lastname} onchange={handleChange}></lightning-input>
                                    </lightning-layout-item>
                                    <!-- Gender field (Picklist) -->
                                    <lightning-layout-item padding="around-small" size="auto" class="fixed-width">
                                    <lightning-combobox class="input-field" required data-index={index} label="Gender" value={guest.gender} options={genderOptions} onchange={handleChange}></lightning-combobox>
                                    </lightning-layout-item>
                                    <!-- Age field -->
                                    <lightning-layout-item padding="around-small" size="auto" class="fixed-width">
                                    <lightning-input class="input-field" type="number" data-index={index} label="Age" pattern="^\d{1,3}$" value={guest.age} onchange={handleChange}></lightning-input>
                                    </lightning-layout-item>
                                    <!-- Designation field -->
                                    <lightning-layout-item padding="around-small" size="auto"  class="fixed-width">
                                    <lightning-input class="input-field" data-index={index} label="Designation" value={guest.designation} onchange={handleChange}></lightning-input>
                                    </lightning-layout-item>
                                    <!-- Travel Class field (Picklist) -->
                                    <lightning-layout-item padding="around-small" size="auto"  class="fixed-width">
                                    <lightning-combobox class="input-field" data-index={index} label="Travel Class" value={guest.travelclass} options={travelClassOptions} onchange={handleChange}></lightning-combobox>
                                    </lightning-layout-item>
                                    <!-- Travel PNR No field -->
                                    <lightning-layout-item padding="around-small" size="auto"  class="fixed-width">
                                    <lightning-input class="input-field" data-index={index} label="Travel PNR No" value={guest.travelpnrno} onchange={handleChange}></lightning-input>
                                    </lightning-layout-item>
                                    <!-- Travel Nationality field -->
                                    <lightning-layout-item padding="around-small" size="auto"  class="fixed-width">
                                        <label class="slds-form-element__label slds-no-flex">
                                            <template if:true={isNationalityRequired}>
                                                <span class="slds-required" style="color: #BA0517;">*</span>
                                            </template>
                                            Nationality
                                        </label>
                                        <lightning-input 
                                            onblur={handleDropDownClose}
                                            variant="label-hidden"
                                            value={guest.nationality} 
                                            onchange={handleNationalityChange} 
                                            onfocus={handleNationalityDropdownOpen} 
                                            label="Nationality"
                                            data-index={index}
                                            required={isNationalityRequired}>
                                        </lightning-input>
                                        <!-- Display filtered options in a dropdown-style list -->
                                        <template if:true={guest.showDropdown}>
                                            <div class="dropdown">
                                                <template for:each={filteredNationalityOptions} for:item="option">
                                                    <div key={option.value} class="dropdown-item" data-index={index} data-value={option.value} data-label={option.label} onmousedown={handleNationalityOptionSelect}>
                                                        {option.label}
                                                    </div>
                                                </template>
                                            </div>
                                        </template>
                                    </lightning-layout-item>
                                    <!-- Travel Passport Number field -->
                                    <lightning-layout-item padding="around-small" size="auto"  class="fixed-width">
                                        <lightning-input class="input-field" data-index={index} label="Passport Number" value={guest.passportnumber} onchange={handleChange}></lightning-input>
                                    </lightning-layout-item>
                                    <!-- Travel Mobile field -->
                                    <lightning-layout-item padding="around-small" size="auto"  class="fixed-width">
                                        <lightning-input class="input-field" data-index={index} type ="text" pattern="^[\+\-]?[0-9]+$" label="Phone" value={guest.phone} onchange={handleChange}></lightning-input>
                                    </lightning-layout-item>
                            </lightning-layout>
                            </div>
                        </template>
                    </lightning-card>
                    <footer class="slds-modal__footer">
                        <lightning-button label="Previous" class="encalmbg" variant="brand" onclick={returnToPassengerCount} style="margin-right: 10px;"></lightning-button>
                        <lightning-button label="Next" class="encalmbg" variant="brand" onclick={openPackageUpgrade} style="margin-right: 10px;"></lightning-button>
                    </footer>
                </template>
                <template lwc:if={isPckUpgradeAll}>
                    <lightning-card title="Upgrade Package">
                        <template lwc:if={filteredPackagesAll}>
                            <div class="slds-modal__content slds-p-around_medium slds-grid slds-nowrap slds-gutters">
                                <div class="slds-col slds-size_12-of-12">
                                    <lightning-card title="Select Package to Upgrade">
                                        <label class="slds-form-element__label slds-no-flex">
                                            <span style="font-size: x-large;">Existing Package - {currentPackage}</span></label>
                                        <div class="slds-card__body">
                                            <div class="slds-grid slds-wrap"  style="margin-left: 15px;" slot="actions">
                                                <template for:each={filteredPackagesAll} for:item="pack" for:index="index">
                                                    <div key={pack.packageName} if:true={pack.showPackage} class="slds-col slds-size_3-of-3 column">
                                                        <div class="package">
                                                            <!-- Apply the class to package name -->
                                                            <div class="slds-text-heading_medium package-name row" style="padding-left: 10px;">
                                                                <span class="left-value" style="font-size: x-large;">{pack.packageName}</span>
                                                                <span class="right-value" style="text-align: right;">{currency} {pack.priceTag}</span>
                                                            </div>                            
                                                            <div class="slds-m-top_medium">
                                        
                                                                <!-- Iterate through services and display each row -->
                                                                <ul class="slds-list_dotted">
                                                                    <template for:each={pack.services} for:item="row">
                                                                        <li key={row} class="slds-item">{row}</li>
                                                                    </template>
                                                                </ul>
                                        
                                                                <!-- Select Button -->
                                                                <lightning-button 
                                                                    label={pack.buttonLabel} 
                                                                    data-index={index} 
                                                                    onclick={handlePackageSelect}>
                                                                </lightning-button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                    </lightning-card>
                                </div>
                            </div>
                        </template>
                        <template lwc:else>
                            <label class="slds-form-element__label slds-no-flex">
                                <span style="font-size: x-large;">{upgradeMessage}</span></label>
                        </template> 
                    </lightning-card>               
                    <footer class="slds-modal__footer">
                        <lightning-button label="Previous" class="encalmbg" variant="brand" onclick={returnToPassengerDetail} style="margin-right: 10px;"></lightning-button>
                        <lightning-button label="Next" class="encalmbg" variant="brand" onclick={openAddonPage} style="margin-right: 10px;"></lightning-button>
                    </footer>
                </template>
                <template lwc:if={isAddOnAll}>
                        <div class="slds-card__body">
                        <template if:true={getAddonDetail}>
                            <div style="font-weight: bold;font-size: 16px;margin-left: 16px;">Select Add Ons</div>
                            <div class="slds-card__body">
                                <div class="slds-grid slds-wrap"  style="margin-left: 15px;" slot="actions">
                                    <template for:each={getAddonDetail} for:item="pack"  for:index="index">
                                        <div key={pack.packageName} class="slds-col slds-size_1-of-3 column">
                                            <div class="package">
                                                
                                                <div class="slds-text-heading_small package-name row" style="padding-left: 10px;">
                                                <!-- Apply the class to package name
                                                <div class="slds-text-heading_small package-name row" style="padding-left: 10px;">{currency} {pack.addOnTag}</div>-->
                                                <span class="left-value-addon">{pack.addOnName}</span>
                                                <span class="right-value-addon">{currency} {pack.addOnTag}</span>
                                                </div>
                                                <div class="slds-m-top_medium">
                                            </br>
                                            <div>
                                                <!-- Pickup Terminals -->
                                            <template for:each={pack.pickupTerminals} for:item="terminal" for:index="index">
                                                <lightning-combobox
                                                    key={terminal.id}
                                                    name="pickup"
                                                    label={terminal.id}
                                                    options={pickupTerminalOptions}
                                                    value={terminal.value}
                                                    data-index={index}
                                                    data-id={pack.addOnName}
                                                    onchange={handleTerminalChange}
                                                    required
                                                    message-when-value-missing="Please select a Pickup Terminal"
                                                    class={pack.pickupErrorClass} 
                                                    disabled={pack.disablePickup}>
                                                </lightning-combobox>
                                            </template>
                    
                                                <!-- Drop Terminals -->
                                            <template if:false={pack.hideDropTerminal}>
                                                <template for:each={pack.dropTerminals} for:item="terminal" for:index="index">                                        
                                                    <lightning-combobox
                                                        key={terminal.id}
                                                        name="drop"
                                                        label={terminal.id}
                                                        options={dropTerminalOptions}
                                                        value={terminal.value}
                                                        data-index={index}
                                                        data-id={pack.addOnName}
                                                        onchange={handleTerminalChange}
                                                        required
                                                        message-when-value-missing="Please select a Drop Terminal"
                                                        class={pack.dropErrorClass} 
                                                        disabled={pack.disableDrop}>
                                                    </lightning-combobox>
                                                </template>
                                            </template>
                                            </div>
                                                <div class="counter">
                                                    <span>Qty</span>
                                                    <button data-id="decrementAddOn" data-index={index}  onclick={decrementAddOn} class="btn minus">-</button>
                                                    <span class="count">{pack.adddOnCount}</span>
                                                    <button data-id="incrementAddOn" data-index={index} onclick={incrementAddOn} class="btn plus">+</button>
                                                </div>
                                            </br>
                                            <button onclick={handleAddOnSelect} data-index={index} class={pack.class}>{pack.buttonLabel}</button> 
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>
                        </div>
                    <footer class="slds-modal__footer">
                        <lightning-button label="Previous" class="encalmbg" variant="brand" onclick={returnToPackageUpgrade} style="margin-right: 10px;"></lightning-button>
                        <lightning-button label="Submit" class="encalmbg" variant="brand" onclick={openSubmitConfirmation} style="margin-right: 10px;"></lightning-button>
                    </footer>
                </template>
           
        </template>

        <!-- Modal for confirmation -->
        <template if:true={confirmAmendment}>
            <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container">
                    <!-- Modal/Confirmation Header -->
                    <header class="slds-modal__header">
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
                            title="Close" onclick={closePopupModal}>
                        <lightning-icon icon-name="utility:close" size="small" alternative-text="close" class="slds-button__icon slds-button__icon_small"></lightning-icon>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                        <h2 class="slds-text-heading_medium">Amendment Confirmation</h2>
                    </header>

                    <!-- Modal Body -->
                    <div class="slds-modal__content slds-p-around_medium">
                        <p>{confirmMessage}</p>
                    </div>

                    <!-- Modal Footer -->
                    <footer class="slds-modal__footer">
                        <lightning-button variant="neutral" label="No" class="encalmbg" onclick={closePopupModal} style="margin-right: 10px;"></lightning-button>
                        <lightning-button variant="brand" label="Yes" class="encalmbg" onclick={handleFinalSubmit}></lightning-button>
                    </footer>
                </div>
            </section>

            <!-- Backdrop for Modal -->
            <div class="slds-backdrop slds-backdrop_open"></div>
        </template>
        <!-- Conditionally display the spinner -->
     <template if:true={isLoading}>
        <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
    </template>
</template>